(function(){!function(a){var b,c,d,e,f,g,h,i,j,k;return c=null,d=null,e=null,k=null,f=null,g=function(a){var b,c,d,e,f;if(window.btoa)return window.btoa(a);for(d=0,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f="";a.charAt(0|d)||(e="=",d%1);)c=a.charCodeAt(d+=.75),b=b<<8|c,f+=e.charAt(63&b>>8-8*(d%1));return f},j=function(a,b){var c,d,e;switch(e=function(a,b){return""+b+"="+encodeURIComponent(a)},c=function(a,b){var c,d;return function(){var e,f,g;for(g=[],c=e=0,f=a.length;f>e;c=++e)d=a[c],g.push(j(d,""+b+"["+c+"]"));return g}().join("&")},d=function(a,b){var c,d,e,f,g,h;for(g=[],e=function(){var b;b=[];for(d in a)h=a[d],b.push(d);return b}(),d=void 0,c=0,f=e.length;f>c;)d=e[c],""!==d&&(null===a[d]?g.push(encodeURIComponent(d)+"="):g.push(j(a[d],b?b+"["+encodeURIComponent(d)+"]":encodeURIComponent(d))),++c);return g.join("&")},toString.call(a)){case"[object Array]":return c(a,b);case"[object Object]":return d(a,b);case"[object String]":return e(a,b);default:return""+b+"="+encodeURIComponent(a)}},h=function(a){var d;return d=new b,i("GET","users/login",a).then(function(a,b){return a||(k=b.session_token,f=b._id,localStorage.setItem(c,JSON.stringify({appToken:e,userToken:k,currentUserId:f}))),d.done(a,b)}),d},i=function(a,f,h,i){var l,m;return null==h&&(h={}),null==i&&(i=null),m=function(a,f,h,i){var l,m,n,o,p,q,r;f="http://api.backnd.info/"+f,h instanceof FormData||(h=j(h)),"GET"===a&&(f+="?"+h),l=k?"Bearer "+k:e?"Bearer "+e:"Basic "+g(c+":"+d),o={Accept:"application/json",Authorization:l},"GET"===a||h instanceof FormData||(o["Content-Type"]="application/x-www-form-urlencoded"),p=new b,r=new window.XMLHttpRequest,r.onreadystatechange=function(){var a,b;if(4===r.readyState)if(200<=(b=r.status)&&300>b||0===r.status)try{return p.done(null,JSON.parse(r.responseText))}catch(c){return a=c,p.done(a,null)}else try{return p.done("unsuccesfull request "+r.status,JSON.parse(r.responseText))}catch(c){return a=c,p.done("unsuccesfull request "+r.status,r.responseText)}},r.open(a,f,!0);for(n in o)q=o[n],r.setRequestHeader(n,q);h instanceof FormData&&i&&(r.onprogress=function(a){return i("progress",a)},r.onload=function(a){return i("load",a)},r.onerror=function(a){return i("error",a)},r.onabort=function(a){return i("abort",a)});try{r.send(h)}catch(s){m=s,p.done(m,null)}return p},e?m(a,f,h,i):(l=new b,m("POST","token",{grant_type:"client_credentials"}).then(function(b,d){return e=d.access_token,localStorage.setItem(c,JSON.stringify({appToken:e,userToken:null,currentUserId:null})),m(a,f,h,i).then(l.done,l)}),l)},b=function(){var a,b,c,d;return a=[],b=!1,d=null,c=null,{then:function(e,f){var g;return g=function(){return e.apply(f,arguments)},b?g(c,d):a.push(g),this},done:function(e,f){var g,h,i;for(d=f,c=e,b=!0,h=0,i=a.length;i>h;h++)g=a[h],g(c,d);return a=[]}}},window.Backnd={init:function(a,b){var g;return c=a,d=b,e=null,k=null,f=null,(g=localStorage.getItem(c))?(g=JSON.parse(g),e=g.appToken,k=g.userToken,f=g.currentUserId):void 0},end:function(){return localStorage.removeItem(c),c=null,d=null,e=null,k=null,f=null},User:{find:function(a){return i("GET","users",a)},register:function(a){var c;return c=new b,i("POST","users",a).then(function(a,b){return a||(k=b.session_token,f=b._id),c.done(a,b)}),c},registerWithFacebook:function(a,b){return null==b&&(b={}),b.auth_data||(b.auth_data={}),b.auth_data.facebook||(b.auth_data.facebook={}),b.auth_data.facebook.access_token||(b.auth_data.facebook.access_token=a),Backnd.User.register(b)},registerWithTwitter:function(a,b,c,d,e){return null==e&&(e={}),e.auth_data||(e.auth_data={}),e.auth_data.twitter||(e.auth_data.twitter={}),e.auth_data.twitter.consumer_key||(e.auth_data.twitter.consumer_key=a),e.auth_data.twitter.consumer_secret||(e.auth_data.twitter.consumer_secret=b),e.auth_data.twitter.access_token||(e.auth_data.twitter.access_token=c),e.auth_data.twitter.access_token_secret||(e.auth_data.twitter.access_token_secret=d),Backnd.User.register(e)},update:function(a){var c;return f?i("PATCH","users/"+f,a):(c=new b,setTimeout(function(){return c.done("unsuccesfull request 401",{code:"InvalidCredentials",message:"user not logged in"})},0),c)},login:function(a,b){var c,d;return d={password:b},c=-1===a.indexOf("@")?"username":"email",d[c]=a,h(d)},loginWithFacebook:function(a){var b;return b={auth_data:{facebook:{access_token:a}}},h(b)},loginWithTwitter:function(a,b,c,d){var e;return e={auth_data:{twitter:{consumer_key:a,consumer_secret:b,access_token:c,access_token_secret:d}}},h(e)},logout:function(){var a;return a=new b,f?i("GET","users/logout").then(function(b,d){return b||(k=null,f=null,localStorage.setItem(c,JSON.stringify({appToken:e,userToken:null,currentUserId:null}))),a.done(b,d)}):setTimeout(function(){return a.done("unsuccesfull request 401",{code:"InvalidCredentials",message:"user not logged in"})},0),a},isLogged:function(){return null!==k&&null!==f},info:function(){var a;return a=new b,f?i("GET","users",{search:{_id:f}}).then(function(b,c){return b?a.done(b,{}):c.length?a.done(null,c[0]):a.done("unsuccesfull request 401",{code:"InvalidCredentials",message:"user not logged in"})}):setTimeout(function(){return a.done("unsuccesfull request 401",{code:"InvalidCredentials",message:"user not logged in"})},0),a},"delete":function(){var a;return a=new b,f?i("DELETE","users/"+f).then(function(b,c){return b||(k=null,f=null),a.done(b,c)}):setTimeout(function(){return a.done("unsuccesfull request 401",{code:"InvalidCredentials",message:"user not logged in"})},0),a},sendActivationEmail:function(a){return i("POST","users/send_activation_email",{email:a})},sendResetPasswordEmail:function(a){return i("POST","users/request_password_reset",{email:a})}},Object:{find:function(a,b){return i("GET",a,b)},create:function(a,b){return i("POST",a,b)},update:function(a,b,c){return i("PATCH",""+a+"/"+b,c)},"delete":function(a,b){return i("DELETE",""+a+"/"+b)}},File:{create:function(a,b){var c;return null==b&&(b=null),c=new FormData,c.append("file",a),i("POST","files",c,b)},"delete":function(a){return i("DELETE","files/"+a)}}},"function"==typeof define&&define.amd?define(function(){return Backnd}):a.Backnd=Backnd,"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports=Backnd:void 0}(this)}).call(this);